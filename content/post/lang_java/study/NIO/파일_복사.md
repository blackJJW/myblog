---
title: "[Java] NIO, FileChannel 파일 복사"
description: ""
date: "2023-01-28T12:00:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"

---
<!--more-->

- 파일 복사를 구현하기 위해서는 하나의 ByteBuffer를 사이에 둔다.
    - 파일 읽기 용 FileChannel과 파일 쓰기 용 FileChannel이 읽기와 쓰기를 교대로 번갈아 수행하도록 한다.
    
    ![Untitled](/images/lang_java/NIO/파일_복사/Untitled.png)
    
- ex) FileChannel을 이요해서 이미지 파일을 복사
    - 채널에서 읽고 다시 채널로 쓰는 경우 다이렉트 버퍼가 좋은 성능을 낸다.
    - FileCopuEx.java
    
    ```java
    import java.io.IOException;
    import java.nio.ByteBuffer;
    import java.nio.channels.FileChannel;
    import java.nio.file.Path;
    import java.nio.file.Paths;
    import java.nio.file.StandardOpenOption;
    
    public class FileCopyEx {
    
    	public static void main(String[] args) throws IOException {
    		Path from = Paths.get("src/fileChannel/p-1.png");
    		Path to = Paths.get("src/fileChannel/p-2.png");
    		
    		// 읽기 FileChannel 생성
    		FileChannel fileChannel_from = FileChannel.open(
    			from, StandardOpenOption.READ);
    		
    		// 쓰기 FileChannel 생성
    		FileChannel fileChannel_to = FileChannel.open(
    				to, StandardOpenOption.CREATE, 
    				StandardOpenOption.WRITE);
    		
    		ByteBuffer buffer = ByteBuffer.allocateDirect(100);
    		int byteCount;
    		while(true) {
    			buffer.clear();
    			byteCount = fileChannel_from.read(buffer); // 읽기
    			if(byteCount == -1) break;
    			buffer.flip();
    			fileChannel_to.write(buffer); // 쓰기
    		}
    		
    		fileChannel_from.close();
    		fileChannel_to.close();
    		System.out.println("파일 복사 성공");
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/NIO/파일_복사/Untitled%201.png)
    
- 단순히 파일을 복사할 목적이라면 NIO의 Files 클래스의 `copy()` 메소드를 사용하는 것이 더 편리
    
    ```java
    Path targetPath = Files.copy(Path source, Path target,
    			CopyOption... options);
    ```
    
    - 첫 번째 source 매개값에는 원본 파일의 Path 객체를 지정
    - 두 번째 target 매개값에는 타겟 파일의 Path 객체를 지정
    - 세 번째 매개값은 다음 세 가지 StandardCopyOption 열거 상수를 목적에 맞게 나열해 준다.
    
    | 열거 상수 | 설명 |
    | --- | --- |
    | REPLACE_EXISTING | 타겟 파일이 존재하면 대체 |
    | COPY_ATTRIBUTES | 파일의 속성까지도 복사 |
    | NOFOLLOW_LINKS | 링크 파일일 경우 링크 파일만 복사하고 링크된 파일은 복사하지 않는다. |
- ex) Files 클래스의 copy() 메소드를 이용하여 이미지 파일을 복사
    - FilesCopyMethodEx.java
    
    ```java
    import java.io.IOException;
    import java.nio.file.Files;
    import java.nio.file.Path;
    import java.nio.file.Paths;
    import java.nio.file.StandardCopyOption;
    
    public class FileCopyMethodEx {
    
    	public static void main(String[] args) throws IOException {
    		Path from = Paths.get("src/fileChannel/p-1.png");
    		Path to = Paths.get("src/fileChannel/p-2.png");
    		
    		Files.copy(from, to, StandardCopyOption.REPLACE_EXISTING);
    		System.out.println("파일 복사 성공");
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/NIO/파일_복사/Untitled%202.png)
    

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판