---
title: "[Java] NIO, TCP 비동기 소켓 채널 데이터 통신"
description: ""
date: "2023-02-05T21:00:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"
  - "Network"

---
<!--more-->

- 클라이언트와 서버가 연결되면 양쪽 AsynchronousSocketChannel의 `read()`와 `write()` 메소드로 데이터 통신을 할 수 있다.
    - `read()`와 `write()`를 호출하는 코드
    
    ```java
    read(ByteBuffer dst, A attachment, 
    		 CompletionHandler<Integer, A> handler);
    write(ByteBuffer dst, A attachment, 
    		 CompletionHandler<Integer, A> handler);
    ```
    
    - 첫 번째 매개값은 읽고 쓰기 위한 ByteBuffer 객체
    - 두 번째 매개값은 콜백 메소드의 매개값으로 제공할 첨부 객체
    - 세 번째 매개값은 `CompletionHandler<Integer, A>` 구현 객체
        - Integer는 읽고 쓴 바이트 수
        - A는 첨부 객체 타입
    
    ### `read()` 메소드는 호출하는 기본 뼈대
    
    ```java
    asynchronousSocketChannel.read(byteBuffer, attachment,
    		new CompletionHandler<Integer, A>() {
    	@Override
    	public void completed(Integer result, A attachment) {
    		// 받은 데이터를 처리하는 코드
    		asynchronousSocketChannel.read(byteBuffer, 
    										attachment, this); // read() 재호출
    	}
    	@Override
    	public void failed(Throwable exc, A attachment) {
    		// 실패된 경우 실행할 코드
    	}
    });
    ```
    
    - 스레드풀의 작업 스레드가 읽기 작업을 완료하면 `completed()` 메소드를 호출
        - 첫 번째 매개값은 읽은 바이트 수
        - 두 번째 매개값은 첨부 객체
            - `read()` 메소드 호출 시 사용된 두 번째 매개값이 대입
    - 만약 스레드풀의 작업 스레드에서 읽기 작업 도중 문제가 생겨 예외가 발생하면 스레드는 `failed()` 메소드를 호출
        - 첫 번째 매개값은 예외 객체
        - 두 번째 매개값은 첨부 객체
            - `read()` 메소드 호출 시 사용된 두 번째 매개값이 대입
    - 주목할 점은 `read()`를 반복해서 호출하는 무한 루프는 없다는 점
        - 대신 `completed()` 메소드 끝에 `read()`를 재호출해서 반복적으로 데이터를 받는 작업을 수행
    
    ### `write()` 메소드를 호출하는 기본 뼈대
    
    ```java
    asynchronousSocketChannel.write(byteBuffer, attachment,
    		new CompletionHandler<Integer, A>() {
    	@Override
    	public void completed(Integer result, A attachment) {
    		// 성공한 경우 실행할 코드
    	}
    	@Override
    	public void failed(Throwable exc, A attachment) {
    		// 실패한 경우 실행할 코드
    	}
    });
    ```
    
    - 스레드풀의 작업 스레드가 쓰기 작업을 완료하면 `completed()` 메소드를 호출
        - 첫 번째 매개값은 사용한 바이트 수
        - 두 번째 매개값은 첨부 객체
            - `write()` 메소드 호출 시 사용된 두 번째 매개값이 대입
    - 만약 스레드풀의 작업 스레드에서 쓰기 작업 도중 문제가 생겨 예외가 발생하면 스레드는 `failed()` 메소드를 호출
        - 첫 번째 매개값은 예외 객체
        - 두 전째 매개값은 첨부 객체
            - `write()` 메소드 호출 시 사용된 두 번째 매개값이 대입

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판