---
title: "[Java] NIO, TCP 블로킹 채널, 소켓 채널 생성과 연결 요청"
description: ""
date: "2023-01-29T17:00:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"
  - "Network"

---
<!--more-->

- 클라이언트가 서버에 연결 요청을 할 때에는 `java.nio.channels.SocketChannel`을 이용
- SocketChannel은 정적 메소드인 `open()`으로 생성
    - 블로킹 방식으로 동작시키기 위해 `configureBlocking(true)` 메소드를 호출
    - 기본적으로 블로킹 방식으로 동작
        - 명시적으로 설정하는 이유는 넌블로킹과 구별하기 위해서이다.
- 서버 연결 요청은 `connect()` 메소드를 호출
    - 서버 IP와 포트 정보를 가진 InetSocketAddress 객체를 매개값으로 주면 된다.
    - `connect()` 메소드는 연결이 완료될 때까지 블로킹
        - 연결이 완료되면 리턴
    - 로컬 PC의 5001 포트에 바인딩된 서버에 연결 요청을 하는 코드
    
    ```java
    SocketChannel socketChannel = SocketChannel.open();
    socketChannel.configureBlocking(true);
    socketChannel.connect(new InetSocketAddress("localhost", 5001);
    ```
    
    - `connect()` 메소드는 서버와 연결이 될 때까지 블로킹되
        - UI 및 이벤트를 처리하는 스레드에서 `connect()`를 호출하지 않도록 한다.
        - 블로킹되면 UI 갱신이나 이벤트 처리를 할 수 없기 때문
- 연결된 후, 클라이언트 프로그램을 종료하거나, 필요에 따라서 연결을 끊고 싶다면 SocketChannel의 `close()` 메소드를 호출
    
    ```java
    socketChannel.close();
    ```
    
- ex) localhost 5001 포트로 연결 요청하는 코드
    - `connect()` 메소드가 정상적으로 리턴되면 연결 성공
    - ClientEx.java
    
    ```java
    import java.io.IOException;
    import java.net.InetSocketAddress;
    import java.nio.channels.SocketChannel;
    
    public class ClientEx {
    
    	public static void main(String[] args) {
    		SocketChannel socketChannel = null;
    		try {
    			socketChannel = SocketChannel.open();
    			socketChannel.configureBlocking(true);
    			System.out.println("[ 연결 요청 ]");
    			socketChannel.connect(new InetSocketAddress("localhost", 5001));
    			System.out.println("[ 연결 성공 ]");
    		} catch(Exception e) {}
    		
    		if(socketChannel.isOpen()) {
    			try {
    				socketChannel.close();
    			} catch(IOException e1) {}
    		}
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/NIO/소켓_채널_생성과_연결_요청/Untitled.png)
    
    - 전 글에서 작성한 ServerEx와 ClientEx을 실행한 결과
        - 먼저 ServerEx를 실행하고 ClientEx를 실행

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판