---
title: "[Java] 성능 향상 보조 스트림"
description: ""
date: "2023-01-10T21:00:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"
---
<!--more-->

- 프로그램의 실행 성능은 입출력이 가장 늦은 장치를 따라간다.
    - CPU와 메모리가 아무리 뛰어나도 하드 디스크의 입출력이 늦어지면 프로그램의 실행 성능은 하드 디스크의 처리 속도에 맞춰진다.
    - 네트워크로 데이터를 전송할 때도 마찬가지
        - 느린 네트워크 환경이라면 컴퓨터 사양이 아무리 좋아도 메신저와 게임의 속도는 느릴 수밖에 없다.
- 이 문제에 대한 완전한 해결책은 될 수 없지만, 프로그램이 입출력 소스와 직접 작업하지 않고 중간에 메모리 버퍼(buffer)와 작업
    - 실행 성능을 향상시킬 수 있다.
    
    ex) 프로그램은 직접 하드 디스트에 데이터를 보내지 않고 메모리 버퍼에 보냄으로써 쓰기 속도가 향상
    
    - 버퍼는 데이터가 쌓이기를 기다렸다가 꽉 차게 되면 데이터를 한꺼번에 하드 디스크로 보냄으로썬 출력 횟수를 줄여준다.
    
    ![Untitled](/images/lang_java/inputOutput/성능_향상_보조_스트림/Untitled.png)
    
- 보조 스트림 중에서 메모리 버퍼를 제공하겨 프로그램의 성능을 향상 시키는 것들이 있다.
    - 바이트 기반 스트림에는 BufferedInputStream, BufferedOutputStream
    - 문자 기반 스트림에는 BufferdReader, BufferedWriter

## 1. BufferedInputStream과 BufferedReader

- BufferedInputStream은 바이트 입력 스트림에 연결되어 버퍼를 제공해주는 보조 스트림
- BufferedReader는 문자 입력 스트림에 연결되어 버퍼를 제공해주는 보조 스트림
- BufferedInputStream과 BufferedReader는 입력 소스로부터 자신의 내부 버퍼 크기만큼 데이터를 미리 읽고 버퍼에 저장해 둔다.
- 프로그램은 외부의 입력 소스로부터 직접 읽는 대신 버퍼로부터 읽음으로써 읽기 성능이 향상
    
    ![Untitled](/images/lang_java/inputOutput/성능_향상_보조_스트림/Untitled%201.png)
    
- BufferedInputStream과 BufferedReader 보조 스트림은 생성자의 매개값으로 준 입력 스트림과 연결되어 8192 내부 버퍼 사이즈를 가지게 된다.
    - BufferedInputStream은 최대 8192 바이트
    - BufferedReader는 최대 8192 문자가 저장
    
    ```java
    BufferedInputStream bis = new BufferedInputStream(바이트입력스트림);
    BufferedReader br = new BufferedReader(문자스트림);
    ```
    
- BufferedInputStream과 BufferedReader로 데이터를 읽어들이는 방법은 InputStream 또는 Reader와 동일
- ex) BufferedInputStream을 사용하지 않았을 때와 사용했을 때, p-1.png 파일을 읽는 성능 차이를 보여주는 예제
    - 실행 결과를 보면 사용했을 때가 훨씬 성능이 좋아진다.
    - BufferedInputStreamEx.java
    
    ```java
    import java.io.BufferedInputStream;
    import java.io.FileInputStream;
    
    public class BufferedInputStreamEx {
    
    	public static void main(String[] args) throws Exception {
    		long start = 0;
    		long end = 0;
    		
    		FileInputStream fis1 = new FileInputStream(
    				"D:{ path }\\p-1.png");
    		start = System.currentTimeMillis();
    		while(fis1.read() != -1) {}
    		end = System.currentTimeMillis();
    		System.out.println("사용하지 않았을 때 : " + (end - start) + "ms");
    		fis1.close();
    		
    		FileInputStream fis2 = new FileInputStream(
    				"D:{ path }\\p-1.png");
    		BufferedInputStream bis = new BufferedInputStream(fis2);
    		start = System.currentTimeMillis();
    		while(bis.read() != -1) {}
    		end = System.currentTimeMillis();
    		System.out.println("사용했을 때 : " + (end - start) + "ms");
    		bis.close();
    		fis2.close();
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/inputOutput/성능_향상_보조_스트림/Untitled%202.png)
    
- BufferedReader는 `readLine()` 메소드를 추가적으로 더 가지고 있다.
    - 이 메소드를 이용하면 캐리지리턴(`\r`) 라인피드(`\n`)로 구분된 행 단위의 문자열을 한꺼번에 읽을 수 있다.
    
    ex) Enter키를 입력하기 전까지 콘솔에서 입력한 모든 문자열을 한꺼번에 얻는다.
    
    ```java
    Reader reader = new InputStreamReader(System.in);
    BufferedReader br = new BufferedReader(reader);
    String inputStr = br.readLine();
    ```
    
- ex) 콘솔로부터 라인 단위로 읽기
    - BufferedReaderEx.java
    
    ```java
    import java.io.BufferedReader;
    import java.io.InputStream;
    import java.io.InputStreamReader;
    import java.io.Reader;
    
    public class BufferedReaderEx {
    
    	public static void main(String[] args) throws Exception {
    		InputStream is = System.in;
    		Reader reader = new InputStreamReader(is);
    		BufferedReader br = new BufferedReader(reader);
    		
    		System.out.print("입력 : ");
    		String lineString = br.readLine();
    		
    		System.out.println("출력 : " + lineString);
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/inputOutput/성능_향상_보조_스트림/Untitled%203.png)
    

## 2. BufferedOutputStream과 BufferedWriter

- BufferedOutputStream은 바이트 출력 스트림에 연결되어 버퍼를 제공해주는 보조 스트림
- BufferedWriter는 문자 출력 스트림에 연결되어 버퍼를 제공해주는 보조 스트림
- BufferedOutputStream과 BufferedWriter는 프로그램에서 전송한 데이터를 내부 버퍼에 쌓아두었다가 버퍼가 꽉 찰 경우
    - 버퍼의 모든 데이터를 한꺼번에 보낸다.
    - 프로그램 입장에서 보면 직접 데이터를 보내는 것이 아니라, 메모리 버퍼로 데이터를 고속 전송하기 때문에 실행 성능이 향상되는 효과를 얻는다.
    
    ![Untitled](/images/lang_java/inputOutput/성능_향상_보조_스트림/Untitled%204.png)
    
- BufferedOutputStream과 BufferedWriter 보조 스트림은 생성자의 매개값으로 준 출력 스트림과 연결되어 8192 내부 버퍼 사이즈를 가지게 된다.
    - BufferedOutputStream은 8192 바이트 최대 저장
    - BufferedWriter는 8192 문자가 최대 저장
    
    ```java
    BufferedOutputStream bos 
         = new BufferedOutputStream(바이트출력스트림);
    BufferedWriter bw = new BufferedWriter(문자출력스트림);
    ```
    
- BufferedOutputStream과 BufferedWriter로 데이터를 출력하는 방법은 OutputStream 또는 Writer와 동일
- 주의할 점은 버퍼가 가득 찼을 때만 출력을 하기 때문에 마지막 남은 부분이 목적지로 가지 못하고 버퍼에 남아 있을 수 있다.
    - 마지막 출력 작업을 마친 후에는 flush() 메소드를 호출하여 버퍼에서 잔류하고 있는 데이터를 모두 보내야 한다.
- ex) 파일 복사
    - BufferedOutputStream을 사용했을 때와 사용하지 않았을 때의 프로그램 실행 성능 차이를 보여줌
        - 실행 결과를 보면 사용했을 때가 훨씬 성능이 좋아지는 것을 확인
    - BufferedOutputStreamEx.java
    
    ```java
    import java.io.BufferedInputStream;
    import java.io.BufferedOutputStream;
    import java.io.FileInputStream;
    import java.io.FileOutputStream;
    
    public class BufferedOutputStreamEx {
    
    	public static void main(String[] args) throws Exception {
    		FileInputStream fis = null;
    		FileOutputStream fos = null;
    		BufferedInputStream bis = null;
    		BufferedOutputStream bos = null;
    		
    		int data = -1;
    		long start = 0;
    		long end = 0;
    		
    		fis = new FileInputStream(
    				"D:\\{ path }\\p-1.png"
    				);
    		bis = new BufferedInputStream(fis);
    		fos = new FileOutputStream("C:/Temp/p-1.png");
    		start = System.currentTimeMillis();
    		while((data = bis.read()) != -1) {
    			fos.write(data);
    		}
    		fos.flush();
    		end = System.currentTimeMillis();
    		fos.close(); bis.close(); fis.close();
    		System.out.println("사용하지 않았을 때 : " 
    		                    + (end - start) + " ms");
    		
    		fis = new FileInputStream(
    				"D:\\{ path }\\p-1.png"
    				);
    		bis = new BufferedInputStream(fis);
    		fos = new FileOutputStream("C:/Temp/p-1.png");
    		bos = new BufferedOutputStream(fos);
    		start = System.currentTimeMillis();
    		while((data = bis.read()) != -1) {
    			bos.write(data);
    		}
    		bos.flush();
    		end = System.currentTimeMillis();
    		bos.close(); fos.close(); bis.close(); fis.close();
    		System.out.println("사용했을 때 : " 
    		                    + (end - start) + " ms");
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/inputOutput/성능_향상_보조_스트림/Untitled%205.png)
    

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판