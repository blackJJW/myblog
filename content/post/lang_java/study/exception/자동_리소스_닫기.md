---
title: "[Java] 자동 리소스 닫기"
description: ""
date: "2022-09-10T21:30:45+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"


---
<!--more-->

- 자바 7에서 새로 추가된 `try`-`with`-`resources`를 사용하면 예외 발생 여부와 상관없이 사용했던 리소스 객체(각종 입출력 스트림, 서버 소켓, 소켓, 각종 채널)의 `close()` 메소드를 호출해서 안전하게 리소스를 닫아준다.
    - 리소스 : 데이터를 읽고 쓰는 객체
        - ex) 파일의 데이터를 읽는 FileInputStream 객체와 파일에 쓰는 FileOutputStream은 리소스 객체
- 리소스 객체를 안전하게 닫기 위해 자바 6 이전까지 사용한 코드
    
    ```java
    FileInputStream fis = null;
    try {
    	fis = new FileInputStream("file.txt");
    	...
    } catch(IOException e) {
    	...
    } finally {
    	if(fis != null){
    		try {
    			fis.close();
    		} catch (IOException e) { }
    	}
    }
    ```
    
    - `finally` 블록에서 `try`-`catch`를 사용해서 `close()` 메소드를 예외 처리해야 하므로 다소 복잡해짐
- 자바 7에서 추가된 `try`-`with`-`resources` 를 사용하면 간단해짐
    - `close()`를 명시적으로 호출한 곳이 없음
    
    ```java
    try(FileInputStream fis = new FileInputStream("file.txt")){
    	...
    } catch(IOException e) {
    	...
    }
    ```
    
    - try 블록이 정상적으로 실행을 완료했거나 도중에 예외가 발생할 경우
        - 자동으로 FileInputStream의 `close()` 메소드가 호출
        - `try{}` 에서 예외가 발생하면 우선 `close()`로 리소스를 닫고 `catch` 블록을 실행
- 복수 개의 리소스를 사용해야하는 경우
    
    ```java
    try(
    	FileInputStream fis = new FileInputStream("file1.txt");
    	FileOutputStream fos = new FileOutputStream("file2.txt");
    ) {
    	...
    } catch(IOException e){
    	...
    }
    ```
    

---

### `try`-`with`-`resources`를 사용하기 위한 조건

- 리소스 객체는 java.lang.AutoCloseable 인터페이스를 구현하고 있어야 한다.
- AutoCloseable에는 `close()` 메소드가 정의되어 있다.
    - `try`-`with`-`resources`는 이 `close()` 메소드를 자동 호출
- ex) AutoCloseable을 구현, FileInputStream 클래스 작성
    - TryWithResourceEx 클래스의 `main()` 메소드에서 `try`-`with`-`resources`를 사용하면 예외가 발생하는 즉시 자동으로 FileInputStream의 `close()`가 호출됨
    - AutoCloseable 구현 클래스
        - FileInputStream.java
        
        ```java
        public class FileInputStream implements AutoCloseable{
        	private String file;
        	
        	public FileInputStream(String file) {
        		this.file = file;
        	}
        	
        	public void read() {
        		System.out.println(file + "을 읽는다.");
        	}
        	
        	@Override
        	public void close() throws Exception{
        		System.out.println(file + "을 닫음");
        	}
        }
        ```
        
        - TryWithResourceEx.java
        
        ```java
        public class TryWithResourceEx {
        
        	public static void main(String[] args) {
        		try(FileInputStream fis = new FileInputStream("file.txt")){
        			fis.read();
        			throw new Exception(); // 강제적으로 예외 발생
        		} catch(Exception e) {
        			System.out.println("예외 처리 코드가 실행됨");
        		}
        
        	}
        
        }
        ```
        
        ![Untitled](/images/lang_java/exception/자동_리소스_닫기/Untitled.png)
        

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판