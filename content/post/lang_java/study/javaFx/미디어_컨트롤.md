---
title: "[Java] JavaFX, 미디어 컨트롤"
description: ""
date: "2022-12-24T21:00:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"
  - "JavaFX"

---
<!--more-->

- 비디오를 재생할 수 있는 MediaView 컨트롤과 볼륨 조절 및 재생 위치 조절을 위한 Slider 컨트롤 그리고 현재 진행 상태를 보여주는 ProgressBar, ProgressIndicator 컨트롤이 있다.
    - Slider와 ProgressBar, ProgressIndicator는 미디어와는 상관없이 다른 용도로 사용 가능
    - ex) ProgressBar와 ProgressIndicator는 네트워크 데이터 송수신 정도를 표시할 때에도 사용 가능
    
    ![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled.png)
    

## MediaPlayer와 MediaView 컨트롤

- MediaView 컨트롤은 비디오를 보여주는 용도로만 사용되기 때문에 특별한 UI를 가지고 있지 않다.
    - 레이아웃상에서 비디오가 위치할 영역을 표시
    - FXML로 MediaView 컨트롤을 선언하는 방법
        
        ```xml
        <MediaView fitHeight="200.0" fitWidth="300.0" preserveRatio="false" />
        ```
        
        - fitWidth와 fitHeight는 MediaView의 폭과 높이를 지정
        - preserveRatio 속성은 비디오 가로-세로비를 유지할 것인지를 지정
            - false : 비디오의 가로-세로비와 상관없이 fitWidth와 fitHeight에 맞게 MediaView의 크기가 고정
            - true : 비디오의 가로비와 세로비를 유지하기 위해 MediaView 크기가 조정
- MediaView 컨트롤은 비디오를 재생하는 기능이 없기 때문에 미디어를 재생하는 MediaPlayer가 있어야 한다.
    - MediaPlayer는 비디오뿐만 아니라 오디오도 재생하는 기능을 가지고 있다.
    - 미디어 소스 경로를 Media 객체 형태로 전달해서 다음과 같이 생성
        
        ```java
        Media media = new Media("미디어 소스 경로");
        MediaPlayer mediaPlayer = new MediaPlayer(media);
        ```
        
    - 만약 비디오와 오디오 파일이 클래스 경로에 있다면 Media를 생성할 때 다음과 같이 상대 경로를 사용하는 것이 좋다.
        
        ```java
        Media media = new Media(getClass().getResource("media/video.mp4").toString());
        MediaPlayer mediaPlayer = new MediaPlayer(media);
        ```
        
    - 미디어 소스가 비디오라면 MediaView의 setMediaPlayer() 메소드로 MediaPlayer 객체를 등록할 수 있다.
        - 오디어 소스로부터 MediaPlayer가 생성되었다면 MediaView는 필요 없다.
        
        ```java
        mediaView.setMediaPlayer(mediaPlayer);
        ```
        
- MediaPlayer를 생성했다고 해서 바로 재생할 수 없고, 재생할 상태(READY)가 될 때까지 기다려야 한다.
    
    ### MediaPlayer가 가질 수 있는 상태와 상태를 변경하는 메소드
    
    ![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%201.png)
    
    ![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%202.png)
    
    - UNKNOWN은 MediaPlayer가 생성된 직후의 상태
    - 미디어 소스를 재생할 준비가 되면 READY 상태로 자동 변경
    - READY 상태에서 `setAutoPlay(true)` 또는 `play()`를 호출하면 PLAYING이 된다.
    - PLAYING 상태에서
        - `pause()`를 호출하면 PAUSED 상태가 된다.
        - `stop()`을 호출하면 STOPPED 상태가 된다.
        - 재생 버퍼에 충분한 데이터가 없을 경우 STALLED 상태가 된다.
            - 주로 네트워크상에서 미디어 소스를 받아 재생할 때, 네트워크 속도가 느려지면 STALLED 상태가 된다.
    - 이 상태들은 `MediaPlayer.Status` 열거 타입으로 모두 정의
        - 코드에서 MediaPlayer의 상태를 알고 싶을 경우 `getStatus()`의 리턴값을 확인하면 된다.
    - 위의 나와있는 상태외에 한 가지 상태가 더 있다.
        - EndOfMedia
            - MediaPlayer가 미디어 소스를 모두 재생했을 때의 상태
            - EndOfMedia 상태에서 `play()`를 호출하면 다시 PLAYING 상태가 될 수 있다.
                - 먼저 `seek()` 메소드로 재생 위치를 처음으로 되돌려야 한다.
    
    ### 상태가 변경되었을 때 Runnable을 설정하는 메소드
    
    ![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%203.png)
    
    - 이런 코드들은 Runnable의 `run()` 메소드에 작성
        - `setOnXXX()` 메소드로 등록
        - 해당 상태가 되었을 경우 Runnable의 `run()` 메소드가 자동 실행된다.
    
    ex) `setOnReady()` 메소드를 작성하는 방법
    
    - MediaPlayer에서 currentTime 속성을 감시하는 ChangeListener를 등록
    - `changed()` 메소드에는 재생 시간을 표시하는 코드들이 작성될 수 있다.
    - 필요하다면 READY 상태에서 PLAYING 상태로 변경하기 위해 재생 버튼을 활성화하는 코드를 작성해야 한다.
    - 만약 재생 버튼을 사용하지 않고 자동 실행을 하고 싶다면 `setAutoPlay(true)`를 호출
    
    ```java
    mediaPlayer.setOnReady(new Runnable() {
    	@Override
    	public void run() {
    		mediaPlayer.currnetTimeProperty()
                      .addListener(new ChangeListener<Duration)() {
    			@override
    			public void changed(ObservableValue<? extends Duration> observable,
                              Duration oldValue, Duration newValue) {
    				// 재생 시간을 표시하는 코드
    
    			}
    		});
    		// 재생 버튼을 활성화 코드 또는 setAutoPlay(true);
    
    	}
    });
    ```
    
- ex) 비디오와 오디오를 재생하는 간단한 플레이어
    - MediaView 컨트롤 배치
        - Root.fxml
    
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    
    <?import javafx.scene.control.Button?>
    <?import javafx.scene.image.Image?>
    <?import javafx.scene.image.ImageView?>
    <?import javafx.scene.layout.AnchorPane?>
    <?import javafx.scene.layout.StackPane?>
    <?import javafx.scene.media.MediaView?>
    
    <AnchorPane prefHeight="220.0" prefWidth="530.0" 
    			xmlns:fx="http://javafx.com/fxml/1" 
    			xmlns="http://javafx.com/javafx/19"
    			fx:controller="mediaView.RootController">
       <children>
          <StackPane layoutX="10.0" layoutY="10.0" 
          			 prefHeight="150.0" prefWidth="200.0">
             <children>
                <ImageView fitHeight="200.0" fitWidth="360.0" 
                		   pickOnBounds="true"
                		   fx:id="imageView">
                   <image>
                      <Image url="@media/audio.png" />
                   </image>
                </ImageView>
                <MediaView fitHeight="200.0" fitWidth="360.0" 
                		   preserveRatio="false"
                		   fx:id="mediaView" />
             </children>
          </StackPane>
          <Button layoutX="385.0" layoutY="15.0" 
          		  mnemonicParsing="false" prefHeight="23.0" 
          		  prefWidth="131.0" text="재생" 
          		  fx:id="btnPlay"/>
          <Button layoutX="385.0" layoutY="39.0" 
          		  mnemonicParsing="false" prefHeight="23.0" 
          		  prefWidth="131.0" text="멈춤" 
          		  fx:id="btnPause"/>
          <Button layoutX="385.0" layoutY="63.0" 
          		  mnemonicParsing="false" prefHeight="23.0" 
          		  prefWidth="131.0" text="중지"
          		  fx:id="btnStop" />
       </children>
    </AnchorPane>
    ```
    
    - 상태 제어
        - RootController.java
    
    ```java
    import java.net.URL;
    import java.util.ResourceBundle;
    
    import javafx.fxml.FXML;
    import javafx.fxml.Initializable;
    import javafx.scene.control.Button;
    import javafx.scene.image.ImageView;
    import javafx.scene.media.Media;
    import javafx.scene.media.MediaPlayer;
    import javafx.scene.media.MediaView;
    
    public class RootController implements Initializable {
    	@FXML private MediaView mediaView;
    	@FXML private ImageView imageView;
    	@FXML private Button btnPlay;
    	@FXML private Button btnPause;
    	@FXML private Button btnStop;
    	
    	private boolean endOfMedia; // 재생 완료를 확인하는 플래그 필드
    	
    	@Override
    	public void initialize(URL location, ResourceBundle resources) {
    		// 미디어 객체 생성
    		//Media media = new Media(getClass().getResources("media/audio.png").toString());
    		Media media = new Media(getClass().getResource("media/video.mp4").toString());
    		
    		// 미디어 플레이어 생성 및 미디어 뷰에 설정
    		MediaPlayer mediaPlayer = new MediaPlayer(media);
    		mediaView.setMediaPlayer(mediaPlayer);
    		
    		// 해당 상태가 되면 실행할 Runnable 설정
    		mediaPlayer.setOnReady(new Runnable() { // Ready 상태가 될 때
    			@Override
    			public void run() {
    				btnPlay.setDisable(false);
    				btnPause.setDisable(true);
    				btnStop.setDisable(true);
    			}
    		});
    		
    		mediaPlayer.setOnPlaying(() -> { // Playing 상태가 될 때 실행
    			btnPlay.setDisable(true);
    			btnPause.setDisable(false);
    			btnStop.setDisable(false);
    		});
    		
    		mediaPlayer.setOnPaused(() -> { // Paused 상태가 될 때 실행
    			btnPlay.setDisable(false);
    			btnPause.setDisable(true);
    			btnStop.setDisable(false);
    		});
    		
    		mediaPlayer.setOnEndOfMedia(() -> { // EndofMedia 상태가 될 때 실행
    			endOfMedia = true;
    			btnPlay.setDisable(false);
    			btnPause.setDisable(true);
    			btnStop.setDisable(true);
    		});
    		
    		mediaPlayer.setOnStopped(() -> { // Stopped 상태가 될 때 실행
    			btnPlay.setDisable(false);
    			btnPause.setDisable(true);
    			btnStop.setDisable(true);
    		});
    		
    		// 버튼 ActionEvent 처리
    		btnPlay.setOnAction(event -> {
    			if(endOfMedia) {        // EndOfMedia 상태일 경우
    				mediaPlayer.stop(); // 재생 중지
    				mediaPlayer.seek(mediaPlayer.getStartTime());
    				                    // 재생 시간을 처음으로 돌림
    			}
    			mediaPlayer.play();     //미디어 재생
    			endOfMedia = false;
    		});
    		btnPause.setOnAction(event -> mediaPlayer.pause());
    		                            // 미디어 일시 정지
    		btnStop.setOnAction(event -> mediaPlayer.stop());
    		                            // 미디어 중지
    	}
    }
    ```
    
    - AppMain.java
    
    ```java
    import javafx.application.Application;
    import javafx.fxml.FXMLLoader;
    import javafx.scene.Parent;
    import javafx.scene.Scene;
    import javafx.stage.Stage;
    
    public class AppMain extends Application {
    	@Override
    	public void start(Stage primaryStage) throws Exception{
    		Parent parent = FXMLLoader.load(getClass().getResource("Root.fxml"));
    		Scene scene = new Scene(parent);
    		
    		primaryStage.setTitle("AppMain");
    		primaryStage.setScene(scene);
    		primaryStage.show();
    	}
    
    	public static void main(String[] args) {
    		launch(args);
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%204.png)
    
    ![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%205.png)
    
    ![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%206.png)
    
    ![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%207.png)
    

## Slider 컨트롤

![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%208.png)

- Track과 Thumb로 구성
- Slider의 value 속성에는 현재 Thumb의 위치값이 저장
    - 최소값 : 0
    - 최대값 : 100
- 기본적으로 Tick marks와 Tick label이 숨겨져 있다.
    - `setShowTickMarks(true)`와 `setShowTickLabels(true)`를 호출하면 볼 수 있다.
    - Block increment 간격은 `setBlockIncrement()`로 설정 가능
- ex) FXML로 Slider 컨트롤을 선언하는 방법
    
    ```xml
    <Slider prefHeight="폭" prefWidth="높이" 
            showTickLabels="true" showTickMarks="true" />
    ```
    
- ex) MediaPlayer의 볼륨을 조정하기 위해 Slider 컨트롤의 value 속성을 감시하는 ChangeListener를 등록
    - MediaPlayer의 volume 속성은 0.0 ~ 1.0값을 가진다.
        - Slider value 속성은 0.0 ~ 100.0 값을 가지므로 Slider의 value 속성값을 100.0으로 나누어서 MediaPlayer의 value 속성값으로 설정
    
    ```java
    sliderVolume.valueProperty().addListener(new ChangeListener<Number>() {
    	@Override
    	public void changed(ObservableValue<? extends Number> observable,
                          Number oldValue, Number newValue) {
    		mediaPlayer.setVolume(sliderVolume.getValue() / 100.0);
    	}
    });
    ```
    

## ProgressBar와 ProgressIndicator 컨트롤

![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%209.png)

- ProgressBar는 수평 막대 모양 컨트롤
- ProgressIndicator는 원형 모양의 컨트롤
- 둘 다 작업의 진행 정도를 표시
    - 미디어 재생 시간을 표시
    - 저장소의 사용량 및 네트워크 통신량을 표시
- ex) FXML로 선언하는 방법
    
    ```xml
    <ProgressBar prefHeight="15" prefWidth="100" progress="0.0" />
    <ProgressIndicator prefHeight="47.0" prefWidth="31.0" progress="0.0" />
    ```
    
- ProgressBar는 ProgressIndicator를 상속한 하위 컨트롤이기 때문에 사용하는 속성들이 모두 동일
    - progress 속성은 진행 정도를 설정
        - 최소값은 0.0 최대값은 1.0
        - 진행 정도는 자바 코드로 다음과 같이 변경 가능
        
        ```java
        progressBar.setProgress(0.0~1.0);
        progressIndicator.setProgress(0.0~1.0);
        ```
        
    - MediaPlayer의 재생 시간을 나타내기 위해서는 현재 재생 시간을 전체 재생 시간으로 나눈값으로 progress 속성값으로 설정
        
        ```java
        double progress =
        mediaPlayer.getCurrnetTime().toSeconds() / mediaPlayer.getTotalDuration().toSeconds();
        progressVar.setProgress(progress);
        progressIndicator.setProgress(progress):
        ```
        
        - 주의할 점은 마지막 재생 시간과 전체 재생 시간이 정확히 일치하지 않기 때문에 마지막 값이 1.0이 되지 않을 수 있다.
            - MediaPlayer가 EndOfMedia 상태가 되었을 때 progress 속성을 강제로 1.0으로 설정하는 것이 좋다.
        
        ```java
        mediaPlayer.setOnEndOfMedia(() -> {
        	progressBar.setProgress(1.0);
        	progressIndicator.setProgress(1.0);
        });
        ```
        
- ex) 재생 시간을 표시하도록 ProgressBar와 ProgressIndcator 컨트롤을 추가
    - 볼륨을 조정하기 위해 Slider 컨트롤을 추가
    - MediaView 컨트롤 배치
        - Root.fxml
    
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    
    <?import javafx.scene.control.Button?>
    <?import javafx.scene.control.Label?>
    <?import javafx.scene.control.ProgressBar?>
    <?import javafx.scene.control.ProgressIndicator?>
    <?import javafx.scene.control.Slider?>
    <?import javafx.scene.image.Image?>
    <?import javafx.scene.image.ImageView?>
    <?import javafx.scene.layout.AnchorPane?>
    <?import javafx.scene.layout.StackPane?>
    <?import javafx.scene.media.MediaView?>
    
    <AnchorPane prefHeight="220.0" prefWidth="530.0" xmlns="http://javafx.com/javafx/19" xmlns:fx="http://javafx.com/fxml/1" fx:controller="mediaView.RootController">
       <children>
          <StackPane layoutX="10.0" layoutY="10.0" prefHeight="150.0" prefWidth="200.0">
             <children>
                <ImageView fx:id="imageView" fitHeight="200.0" fitWidth="360.0" pickOnBounds="true">
                   <image>
                      <Image url="@media/audio.png" />
                   </image>
                </ImageView>
                <MediaView fx:id="mediaView" fitHeight="200.0" fitWidth="360.0" preserveRatio="false" />
             </children>
          </StackPane>
          <Button fx:id="btnPlay" layoutX="385.0" layoutY="15.0" mnemonicParsing="false" prefHeight="23.0" prefWidth="131.0" text="재생" />
          <Button fx:id="btnPause" layoutX="385.0" layoutY="39.0" mnemonicParsing="false" prefHeight="23.0" prefWidth="131.0" text="멈춤" />
          <Button fx:id="btnStop" layoutX="385.0" layoutY="63.0" mnemonicParsing="false" prefHeight="23.0" prefWidth="131.0" text="중지" />
          
          <!-- ProgressBar & ProgressIndicator -->
          <Label layoutX="387.0" layoutY="101.0" text="시간" />
          <ProgressBar layoutX="385.0" layoutY="121.0" 
          			   prefHeight="18.0" prefWidth="98.0" 
          			   progress="0.0" 
          			   fx:id="progressBar"/>
          <ProgressIndicator layoutX="489.0" layoutY="112.0" 
          					 prefHeight="47.0" prefWidth="31.0" 
          					 progress="0.0" 
          					 fx:id="progressIndicator"/>
          <Label alignment="CENTER" layoutX="386.0" 
          		 layoutY="142.0" prefHeight="18.0" 
          		 prefWidth="98.0" text="0/0 sec" 
          		 fx:id="labelTime"/>
          
          <!-- Slider -->
          <Label layoutX="385.0" layoutY="169.0" text="소리" />
          <Slider layoutX="385.0" layoutY="187.0" 
          		  prefHeight="14.0" prefWidth="131.0" 
          		  showTickMarks="true" 
          		  fx:id="sliderVolume"/>
       </children>
    </AnchorPane>
    ```
    
    - 상태 제어
        - RootController.java
    
    ```java
    import java.net.URL;
    import java.util.ResourceBundle;
    
    import javafx.beans.value.ChangeListener;
    import javafx.beans.value.ObservableValue;
    import javafx.fxml.FXML;
    import javafx.fxml.Initializable;
    import javafx.scene.control.Button;
    import javafx.scene.control.Label;
    import javafx.scene.control.ProgressBar;
    import javafx.scene.control.ProgressIndicator;
    import javafx.scene.control.Slider;
    import javafx.scene.image.ImageView;
    import javafx.scene.media.Media;
    import javafx.scene.media.MediaPlayer;
    import javafx.scene.media.MediaView;
    import javafx.util.Duration;
    
    public class RootController implements Initializable {
    	@FXML private MediaView mediaView;
    	@FXML private ImageView imageView;
    	@FXML private Button btnPlay;
    	@FXML private Button btnPause;
    	@FXML private Button btnStop;
    	
    	// Slider & ProgressBar & ProgressIndicator
    	@FXML private Label labelTime;
    	@FXML private Slider sliderVolume;
    	@FXML private ProgressBar progressBar;
    	@FXML private ProgressIndicator progressIndicator;
    	
    	private boolean endOfMedia; // 재생 완료를 확인하는 플래그 필드
    	
    	@Override
    	public void initialize(URL location, ResourceBundle resources) {
    		// 미디어 객체 생성
    		Media media = new Media(getClass().getResource("media/audio.mp3").toString());
    		//Media media = new Media(getClass().getResource("media/video.mp4").toString());
    		
    		// 미디어 플레이어 생성 및 미디어 뷰에 설정
    		MediaPlayer mediaPlayer = new MediaPlayer(media);
    		mediaView.setMediaPlayer(mediaPlayer);
    		
    		// 해당 상태가 되면 실행할 Runnable 설정
    		mediaPlayer.setOnReady(new Runnable() { // Ready 상태가 될 때
    			@Override
    			public void run() {
    				btnPlay.setDisable(false);
    				btnPause.setDisable(true);
    				btnStop.setDisable(true);
    			}
    		});
    		
    		mediaPlayer.setOnPlaying(() -> { // Playing 상태가 될 때 실행
    			btnPlay.setDisable(true);
    			btnPause.setDisable(false);
    			btnStop.setDisable(false);
    		});
    		
    		mediaPlayer.setOnPaused(() -> { // Paused 상태가 될 때 실행
    			btnPlay.setDisable(false);
    			btnPause.setDisable(true);
    			btnStop.setDisable(false);
    		});
    		
    		mediaPlayer.setOnEndOfMedia(() -> { // EndofMedia 상태가 될 때 실행
    			endOfMedia = true;
    			btnPlay.setDisable(false);
    			btnPause.setDisable(true);
    			btnStop.setDisable(true);
    		});
    		
    		mediaPlayer.setOnStopped(() -> { // Stopped 상태가 될 때 실행
    			btnPlay.setDisable(false);
    			btnPause.setDisable(true);
    			btnStop.setDisable(true);
    		});
    		
    		// 버튼 ActionEvent 처리
    		btnPlay.setOnAction(event -> {
    			if(endOfMedia) {        // EndOfMedia 상태일 경우
    				mediaPlayer.stop(); // 재생 중지
    				mediaPlayer.seek(mediaPlayer.getStartTime());
    				                    // 재생 시간을 처음으로 돌림
    			}
    			mediaPlayer.play();     //미디어 재생
    			endOfMedia = false;
    		});
    		btnPause.setOnAction(event -> mediaPlayer.pause());
    		                            // 미디어 일시 정지
    		btnStop.setOnAction(event -> mediaPlayer.stop());
    		                            // 미디어 중지
    		
    		// 해당 상태가 되면 실행할 Runnable 설정
    		mediaPlayer.setOnReady(new Runnable() {
    			@Override
    			public void run() {
    				mediaPlayer.currentTimeProperty().addListener(new ChangeListener<Duration>() {
    					@Override
    					public void changed(ObservableValue<? extends Duration> observable,
    							            Duration oldValue, Duration newValue) {
    						double progress = mediaPlayer.getCurrentTime().toSeconds() / 
    								mediaPlayer.getTotalDuration().toSeconds();
    						progressBar.setProgress(progress);
    						progressIndicator.setProgress(progress);
    						labelTime.setText(
    								(int) mediaPlayer.getCurrentTime().toSeconds() + "/" +
    								(int) mediaPlayer.getTotalDuration().toSeconds() + " sec");
    					}
    				});
    				
    				btnPlay.setDisable(false);
    				btnPause.setDisable(true);
    				btnStop.setDisable(true);
    			}
    		});
    		
    		mediaPlayer.setOnEndOfMedia(() -> {
    			// 미디어 재생이 완료되었을 때 progress의 속성값을 1.0으로 설정
    			progressBar.setProgress(1.0);
    			progressIndicator.setProgress(1.0);
    			
    			endOfMedia = true;
    			btnPlay.setDisable(false);
    			btnPause.setDisable(true);
    			btnStop.setDisable(true);
    		});
    		
    		// 볼륨 설정
    		// Slider의 value 속성 감시
    		sliderVolume.valueProperty().addListener(new ChangeListener<Number>() {
    			@Override
    			public void changed(ObservableValue<? extends Number> observable,
    					Number oldValue, Number newValue) {
    				mediaPlayer.setVolume(sliderVolume.getValue() / 100.0);
    			}
    		});
    		sliderVolume.setValue(50.0); // Slider 초기값
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/javaFx/미디어_컨트롤/Untitled%2010.png)
    

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판
- [https://docs.oracle.com/javafx](https://docs.oracle.com/javafx)