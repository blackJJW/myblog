---
title: "[Java] 스트림의 특징"
description: ""
date: "2022-11-22T21:30:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"


---
<!--more-->

- Stream은 Iterator와 비슷한 역할을 하는 반복자
    - 람다식으로 요소 처리 코드를 제공
    - 내부 반복자를 사용하므로 병렬 처리가 쉬움
    - 중간 처리와 최종 처리 작업을 수행

## 1. 람다식으로 요소 처리 코드를 제공

- Stream이 제공하는 대부분의 요소 처리 메소드는 함수적 인터페이스 매개 타입을 가진다.
    - 람다식 또는 메소드 참조를 이요해서 요소 처리 내용을 매개값으로 전달 가능
- ex) 요소 처리를 위한 람다식
    - 컬렉션에 저장된 Student를 하나씩 가져와 학생 이름과 성적을 콘솔에 출력하도록 forEach() 메소드의 매개값으로 람다식을 주었다.
    - LambdaExpressionEx.java
    
    ```java
    import java.util.Arrays;
    import java.util.List;
    import java.util.stream.Stream;
    
    public class LambdaExpressionEx {
    
    	public static void main(String[] args) {
    		List<Student> list = Arrays.asList(
    				new Student("ABC", 90),
    				new Student("DEF", 92)
    				);
    		
    		// 스트림 얻기
    		Stream<Student> stream = list.stream();
    		
    		// List 컬렉션에서 Student를 가져와 람다식의 매개값으로 제공
    		stream.forEach( s -> {
    			String name = s.getName();
    			int score = s.getScore();
    			System.out.println(name + " - " + score);
    			
    		} );
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/stream/스트림의_특징/Untitled.png)
    
- ex) 학생 클래스
    - Student.java
    
    ```java
    public class Student {
    	private String name;
    	private int score;
    	
    	public Student (String name, int score) {
    		this.name = name;
    		this.score = score;
    	}
    	
    	public String getName() { return name; }
    	public int getScore() { return score; }
    }
    ```
    

## 2. 내부 반복자를 사용하므로 병렬 처리가 쉬움

- 외부 반복자(external iterator)란 개발자가 코드로 직접 컬렉션의 요소를 반복해서 가져오는 코드 패턴
    - index를 이용하는 for문 그리고 Iterator를 이용하는 while문은 모두 외부 반복자를 이용하는 것
- 내부 반복자(internal iterator)는 컬렉션 내부에서 요소들을 반복시키고, 개발자는 요소당 처리해야 할 코드만 제공하는 코드 패턴
    
    ### 외부 반복자와 내부 반복자
    
    ![Untitled](/images/lang_java/stream/스트림의_특징/Untitled%201.png)
    
- 내부 반복자를 사용해서 얻는 이점
    - 컬렉션 내부에서 어떻게 요소를 반복시킬 것이가는 컬렉션에 맡긴다.
        - 개발자는 요소 처리 코드에만 집중 가능
    - 요소들의 반복 순서를 변경하거나, 멀티 코어 CPU를 최대한 활용하기 위해 요소들을 분배시켜 병렬 작업을 할 수 있게 도와 준다.
        - 하나씩 처리하는 순차적 외부 반복자보다는 효율적으로 요소를 반복시킬 수 있다.
    
    ![Untitled](/images/lang_java/stream/스트림의_특징/Untitled%202.png)
    
- Iterator는 컬렉션의 요소를 가져오는 것에서부터 처리하는 것까지 모두 개발자가 작성해야 한다.
    - 스트림은 람다식으로 요소 처리 내용만 전달
        - 반복은 컬렉션 내부에서 발생
    - 스트림을 이용하면 코드가 간결해짐
        - 요소의 병렬 처리가 컬렉션 내부에서 처리되므로 일석이조의 효과를 가져온다.
- 병렬(parallel) 처리
    - 한 가지 작없을 서브 작업으로 나누고, 서브 작업들을 분리된 스레드에서 병렬적으로 처리하는 것을 말함
- 병렬 처리 스트림을 이용하면 런타임 시 하나의 작업을 서브 작업으로 자동으로 나눈다.
    - 서브 작업의 결과를 자동으로 결합해서 최종 결과물을 생성
    - ex) 컬렉션의 요소 총합을 구할 때 순차 처리 스트림은 하나의 스레드가 요소들을 순차적으로 읽어 합을 구하는 것이 가능
        - 병렬 처리 스트림을 이용할 시, 여러 개의 스레드가 요소들을 부분적으로 합하고 이 부분합을 최종 결합해서 전체 합을 구한다.
- ex) 병렬 처리
    - ParallelEx.java
    
    ```java
    import java.util.Arrays;
    import java.util.List;
    import java.util.stream.Stream;
    
    public class ParallelEx {
    
    	public static void main(String[] args) {
    		List<String> list = Arrays.asList(
    				"ABC", "DEF", "GHI", 
    				"JKL", "MNO"
    				);
    		
    		// 순차 처리
    		Stream<String> stream = list.stream();
    		stream.forEach(ParallelEx :: print);
    				    // 메소드 참조(s -> ParallelEx.print(s)와 동일)
    		System.out.println();
    		
    		// 병렬 처리
    		Stream<String> parallelStream = list.parallelStream();
    		parallelStream.forEach(ParallelEx :: print);
    		                    // 메소드 참조
    	}
    	
    	public static void print(String str) {
    		System.out.println(str + " : " + Thread.currentThread().getName());
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/stream/스트림의_특징/Untitled%203.png)
    

## 3. 스트림은 중간 처리와 최종 처리를 할 수 있다.

- 스트림은 컬렉션의 요소에 대해 중간 처리와 최종 처리를 수행 가능
    - 중간 처리는 매핑, 필터링, 정렬을 수행
    - 최종 처리는 반복, 카운팅, 평균, 총합 등의 집계 처리를 수행
    
    ![Untitled](/images/lang_java/stream/스트림의_특징/Untitled%204.png)
    
- ex) 학생 객체를 요소로 가지는 컬렉션이 있다고 가정
    - 중간 처리에서는 학생의 점수를 뽑아내다.
    - 최종 처리에서는 점수의 평균값을 산출
    
    ![Untitled](/images/lang_java/stream/스트림의_특징/Untitled%205.png)
    
- ex) 중간 처리와 최종 처리
    - List에 저장되어 있는 Student 객체를 중간 처리에서 score 필드값으로 매핑하고, 최종 처리에서 score의 평균값을 산출
    - MapAndReduceEx.java
    
    ```java
    import java.util.Arrays;
    import java.util.List;
    
    public class MapAndReduceEx {
    
    	public static void main(String[] args) {
    		List<Student> studentList = Arrays.asList(
    				new Student("ABC", 10),
    				new Student("DEF", 20),
    				new Student("GHI", 30)
    				);
    		
    		double avg = studentList.stream()
    				// 중간 처리(학생 객체를 점수로 매핑)
    				.mapToInt(Student :: getScore)
    				// 최동 처리(평균 점수)
    				.average()
    				.getAsDouble();
    		
    		System.out.println("평군 점수 : " + avg);
    
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/stream/스트림의_특징/Untitled%206.png)
    
- ex) Student.java
    
    ```java
    public class Student {
    	private String name;
    	private int score;
    	
    	public Student (String name, int score) {
    		this.name = name;
    		this.score = score;
    	}
    	
    	public String getName() { return name; }
    	public int getScore() { return score; }
    }
    ```
    

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판