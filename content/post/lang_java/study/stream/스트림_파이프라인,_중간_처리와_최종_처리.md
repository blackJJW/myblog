---
title: "[Java] 스트림 파이프라인, 중간 처리와 최종 처리"
description: ""
date: "2022-11-26T21:40:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"


---
<!--more-->

- 대량의 데이터를 가공해서 축소하는 것을 일반적으로 리덕션(Reduction)
    - 데이터의 합계, 평균값, 카운팅, 최대값, 최소값 등이 대표적인 리덕션의 결과물
    - 컬렉션의 요소를 리덕션의 결과물로 바로 집계할 수 없을 경우에는 집계하기 좋도록 필터링, 매핑, 정렬, 그룹핑 등의 중간 처리가 필요

## 중간 처리와 최종 처리

- 스트림은 데이터의 필터링, 매핑, 정렬, 그룹핑 등의 중간 처리와 합계, 평균, 카운팅, 최대값, 최소값 등의 최종 처리를 파이프라인(pipelines)으로 해결
    - 파이프라인은 여러 개의 스트림이 연결되어 있는 구조
    - 파이프라인에서 최종 처리를 제외하고는 모두 중간 처리 스트림
    
    ![Untitled](/images/lang_java/stream/스트림_파이프라인,_중간_처리와_최종_처리/Untitled.png)
    
- 중간 스트림이 생성될 때 요소들이 바로 중간 처리(필터링, 매핑, 정렬)되는 것이 아니라 최종 처리가 시작되기 전까지 중간 처리는 지연(lazy)된다.
- 최종 처리가 시작되면 비로소 컬렉션의 요소가 하나씩 중간 스트림에서 처리되고 최종 처리까지 오게 된다.
- Stream 인터페이스에는 필터링, 매핑, 정렬 등의 많은 중간 처리 메소드가 존재
    - 이 메소드들은 중간 처리된 스트림을 리턴
    - 이 스트림에서 다시 중간 처리 메소드를 호출해서 파이프라인을 형성하게 된다.
    - ex) 회원 컬렉션에서 남자만 필터링하는 중간 스트림을 연결
        - 다시 남자의 나이로 매핑하는 스트림을 연결
        - 최종 남자 평균 나이를 집계
    
    ![Untitled](/images/lang_java/stream/스트림_파이프라인,_중간_처리와_최종_처리/Untitled%201.png)
    
    - 파이프라인을 자바 코드로 표현
    
    ```java
    Stream<Member> maleFemaleStream = list.stream();
    Stream<Member> maleStream = maleFemaleStream.filter(m -> m.getSex() == Member.MALE);
    IntStream ageStream = maleStream.mapToInt(Member :: getAge);
    OptionalDouble optionalDouble = ageStream.average();
    double ageAvg = optionalDouble.getAsDouble();
    ```
    
    - 로컬 변수를 생략하고 연결하면 다음과 같은 형태의 파이프라인 코드만 남긴다.
    
    ```java
    double ageAvg = list.stream()     // 오리지날 스트림
    					.filter(m -> m.getSex() == Member.Male) // 중간 처리 스트림
    					.mapToInt(Member :: getAge)
    					.average() // 최종 처리
    					.getAsDouble();
    ```
    
    - `filter(m -> m.getSex() == Member.MALE)`는 남자 Member 객체를 요소로 하는 새로운 스트림을 생성
    - `mapToInt(Member :: getAge())`는 Member 객체를 age 값으로 매핑해서 age를 새로운 요소로하는 새로운 스트림을 생성
    - `average()` 메소드는 age 요소들의 평균을 OptionalDouble에 저장
        - OptionalDouble에서 저장된 평균값을 읽으려면 `getAsDouble()` 메소드를 호출하면 된다.
- ex) 스트림 파이프라인
    - StreamPipelinesEx.java
    
    ```java
    import java.util.Arrays;
    import java.util.List;
    
    public class StreamPipelinesEx {
    
    	public static void main(String[] args) {
    		List<Member> list = Arrays.asList(
    				new Member("ABC", Member.MALE, 30),
    				new Member("DEF", Member.FEMALE, 20),
    				new Member("GHI", Member.MALE, 45),
    				new Member("JKL", Member.FEMALE, 27)
    				);
    		
    		double ageAvg = list.stream()
    				.filter(m -> m.getSex() == Member.MALE)
    				.mapToInt(Member :: getAge)
    				.average()
    				.getAsDouble();
    		
    		System.out.println("남자 평균 나이 : " + ageAvg);
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/stream/스트림_파이프라인,_중간_처리와_최종_처리/Untitled%202.png)
    
- ex) 회원 클래스
    - Member.java
    
    ```java
    public class Member {
    	public static int MALE = 0;
    	public static int FEMALE = 1;
    	
    	private String name;
    	private int sex;
    	private int age;
    	
    	public Member(String name, int sex, int age) {
    		this.name = name;
    		this.sex = sex;
    		this.age = age;
    	}
    	
    	public int getSex() { return sex; }
    	public int getAge() { return age; }
    }
    ```
    

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판