---
title: "[Java] 스트림, 그룹핑 후 매핑 및 집계"
description: ""
date: "2022-12-10T13:40:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"


---
<!--more-->

- `Collectors.groupingBy()` 메소드는 그룹핑 후, 매핑이나 집계(평균, 카운팅, 연결, 최대, 최소, 합계)를 할 수 있도록 두 번째 매개값으로 Collector를 가질 수 있다.
- Collectors는 `mapping()` 메소드 이외에도 집계를 위해 다양한 Collector를 리턴하는 메소드를 제공
    
    ![Untitled](/images/lang_java/stream/그룹핑_후_매핑_및_집계/Untitled.png)
    
- ex) 학생들을 성별로 그룹핑
    - 같은 그룹에 속하는 학생들의 평균 점수를 구함
    - 성별을 키로, 평균 점수를 값으로 갖는 Map을 생성
    
    ```java
    1) Stream<Student> totalStream = totalList.stream();
    
    2) Function<Student, Student.Sex> classifier = Student :: getSex;
    
    3) ToDoubleFunction<Student> mapper = Student :: getScore;
    4) Collector<Student, ?, Double> collector1 = Collectors.averagingDouble(mapper);
    
    5) Collector<Student, ?, Map<Student.Sex, Double>> collector2 =
            Collectors.groupingBy(classifier, collector1);
    
    6) Map<Student.Sex, Double> mapBySex = totalStream.collect(collector2);
    ```
    
    1) 전체 학생 List에서 Stream을 얻는다.
    
    2) Student를 `Student.Sex`로 매핑하는 Function을 얻는다.
    
    3) Student를 점수로 매핑하는 ToDoubleFunction을 얻는다.
    
    4) 학생 점수의 평균을 산출하는 Collector를 얻는다.
    
    5) `Student.Sex`가 키이고, 평균 점수 Double이 값인 Map을 생성하는 Collector를 얻는다.
    
    6) Stream의 `collect()` 메소드로 Student를 `Student.Sex`별로 그룹핑해서 Map을 얻는다.
    
    - 상기 코드에서 변수를 생략하면 다음과 같이 작성 가능
        
        ```java
        Map<Student.Sex, Double> mapBySex = totalList.stream()
        		.collect(
        			Collectors.groupingBy(
        				Student :: getSex,
        				Collectors.averagingDouble(Student :: getScore)
        			)
        		);
        ```
        
- ex) 학생들을 성별로 그룹핑
    - 같은 그룹에 속하는 학생 이름을 쉼표로 구분해서 문자열로 만듦
    - 성별을 키로, 이름 문자열을 값으로 갖는 Map을 생성
    
    ```java
    Map<Student.Sex, String> mapByName = totalList.stream()
    	.collect(
    		Collectors.groupingBy(
    			Student :: getSex,
    			Collectors.mapping(
    				Student :: getName,
    				Collectors.joining(",")
    			)
    		)
    	);
    ```
    
- ex) 그룹핑 후 리덕션
    - GroupingAndReductionEx.java
    
    ```java
    import java.util.Arrays;
    import java.util.List;
    import java.util.Map;
    import java.util.stream.Collectors;
    
    public class GroupingAndReductionEx {
    
    	public static void main(String[] args) {
    		List<Student> totalList = Arrays.asList(
    				new Student("ABC", 10, Student.Sex.MALE),
    				new Student("DEF", 12, Student.Sex.FEMALE),
    				new Student("GHI", 10, Student.Sex.MALE),
    				new Student("JKL", 12, Student.Sex.FEMALE)
    		);
    		
    		// 성별로 평균 점수를 저장하는 Map 얻기
    		Map<Student.Sex, Double> mapBySex = totalList.stream()
    				.collect(
    					Collectors.groupingBy(
    						Student :: getSex,
    						Collectors.averagingDouble(Student :: getScore)
    					)
    				);
    		
    		System.out.println("남학생 평균 점수 : " + mapBySex.get(Student.Sex.MALE));
    		System.out.println("여학생 평균 점수 : " + mapBySex.get(Student.Sex.FEMALE));
    		
    		// 성별을 쉼표로 구분한 이름을 저장하는 Map 얻기
    		Map<Student.Sex, String> mapByName = totalList.stream()
    				.collect(
    					Collectors.groupingBy(
    						Student :: getSex,
    						Collectors.mapping(
    								Student :: getName,
    								Collectors.joining(",")
    						)
    					)
    				);
    		
    		System.out.println("남학생 전체 이름 : " + mapByName.get(Student.Sex.MALE));
    		System.out.println("여학생 전체 이름 : " + mapByName.get(Student.Sex.FEMALE));
    	}
    }
    ```
    
    ![Untitled](/images/lang_java/stream/그룹핑_후_매핑_및_집계/Untitled%201.png)
    

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판