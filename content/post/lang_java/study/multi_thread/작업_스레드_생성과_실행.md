---
title: "[Java] 작업 스레드 생성과 실행"
description: ""
date: "2022-10-03T14:40:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"


---
<!--more-->

- 멀티 스레드로 실행하는 애플리케이션을 개발하려면 먼저 몇 개의 작업을 병렬로 실행할지 결정하고 각 작업별로 스레드를 생성해야 한다.
    
    ![Untitled](/images/lang_java/multi_thread/작업_스레드_생성과_실행/Untitled.png)
    
- 어떤 자바 애플리케이션이건 메인 스레드는 반드시 존재
    - 메인 작업 이외에 추가적인 병렬 작업의 수만큼 스레드를 생성
    - 자바에서는 작업 스레드오 객체로 생성되기 때문에 클래스가 필요
    - `java.lang.Thread` 클래스를 직접 객체화해서 생성해도 되지만, Thread를 상속해서 하위 클래스를 만들어 생성 가능

---

# 1. Thread 클래스로부터 직접 생성

- `java.lang.Thread` 클래스로부터 작업 스레드 객체를 직접 생성하려면 Runnable을 매개값으로 갖는 생성자를 호출해야 한다.
    
    ```java
    Thread thread = new Thread(Runnable target);
    ```
    
    - Runnable은 작업 스레드가 실행할 수 있는 코드를 가지고 있는 객체라고 해서 붙여진 이름
        - Runnable은 인터페이스 타입이기 때문에 구현 객체를 만들어 대입해야 한다.
        - `run()` 메소드 하나가 정의되어 있는데, 구현 클래스는 `run()`을 재정의해서 작업 스레드가 실행할 코드를 작성해야 한다.
    - Runnable 구현 클래스를 작성하는 방법
        
        ```java
        class Task implements Runnable {
        	public void run() {
        		스레드가 실행할 코드;
        	}
        }
        ```
        
- Runnable은 작업 내용을 가지고 있는 객체이지 실제 스레드는 아니다.
- Runnable 구현 객체를 생성한 후, 이것을 매개값으로 해서 Thread 생성자를 호출하면 비로소 작업 스레드가 생성된다.
    
    ```java
    Runnable task = new Task();
    
    Thread thread = new Thread(task);
    ```
    
- 코드를 좀 더 절약하기 위해 Thread 생성자를 호출할 때 Runnable 익명 객체를 매개값으로 사용 가능
    - 이 방법이 더 많이 사용됨
    
    ```java
    Thread thread = new Thread(new Runnable(){ // 익명 객체 구현
    	public void run(){
    		스레드가 실행할 코드;
    	}
    });
    ```
    
- Runnable 인터페이스는 run() 메소드 하나만 정의되어 있기 때문에 함수적 인터페이스
    - 람다식을 매개값으로 사용 가능
    - 자바 8부터 지원
    
    ```java
    Thread thread = new Thread(() -> { // 람다식
    	스레드가 실행할 코드;
    });
    ```
    
- 작업 스레드는 생성되는 즉시 실행되는 것이 아니라, `start()` 메소드를 호출해야만 비로소 실행
    
    ```java
    thread.start();
    ```
    
    - `start()` 메소드가 호출되면, 작업 스레드는 매개값으로 받은 Runnable의 `run()` 메소드를 실행하면서 자신의 작업을 처리
    
    ![Untitled](/images/lang_java/multi_thread/작업_스레드_생성과_실행/Untitled%201.png)
    
- 0.5초 주기로 비프(beep)음을 발생시키면서 동시에 프린팅하는 작업이 있다고 가정
    - 비프음 발생과 프린팅은 서로 다른 작업이므로 메인 스레드가 동시에 두 가지 작업을 처리할 수 없다.
- ex) 메인 스레드만 이용한 경우
    - 메인스레드는 비프음을 모두 발생한 다음, 프린팅 시작
    - BeepPrintEx1.java
    
    ```java
    import java.awt.Toolkit;
    
    public class BeepPrintEx1 {
    
    	public static void main(String[] args) {
    		// Toolkit 객체 얻기
    		Toolkit toolkit = Toolkit.getDefaultToolkit();
    		
    		for(int i = 0; i < 5; i++) {
    			toolkit.beep(); // 비프음 발생
    			try {Thread.sleep(500);} catch(Exception e) {}
    		}         // 0.5초간 일시 정지
    		
    		for(int i = 0; i < 5; i++) {
    			System.out.println("beep!!");
    			try {Thread.sleep(500);} catch(Exception e) {}
    		}          // 0.5초간 일시 정지
    
    	}
    
    }
    ```
    
    ![Untitled](/images/lang_java/multi_thread/작업_스레드_생성과_실행/Untitled%202.png)
    
- ex) 비프음을 들려주는 작업 정의
    - 비프음을 발생시키면서 동시에 프린팅을 하려면 두 작업 중 하나를 메인 스레드가 아닌 다른 스레드에서 실행시켜야 한다.
        - 프린팅은 메인 스레드가 담당
        - 비프음을 들려주는 것은 작업 스레드가 담장
    - 작업을 정의하는 Runnable 구현 클래스를 작성
    - BeepTask.java
    
    ```java
    import java.awt.Toolkit;
    
    public class BeepTask implements Runnable{
    	public void run() {
    		// 스레드 실행 내용
    		Toolkit toolkit = Toolkit.getDefaultToolkit();
    		for(int i = 0; i < 5; i++) {
    			toolkit.beep();
    			try {Thread.sleep(500); } catch(Exception e) {}
    		}
    	}
    }
    ```
    
- ex) 메인 스레드와 작업 스레드가 동시에 실행
    - BeepPrintEx1.java에서 비프음을 발생하는 코드를 작업 스레드 생성 및 실행 코드로 변경
    - BeepPrintEx2.java
    
    ```java
    public class BeepPrintEx2 {
    
    	public static void main(String[] args) { // 메인 스레드
    		Runnable beepTask = new BeepTask(); 
    		Thread thread = new Thread(beepTask); 
    		thread.start(); // BeepRunable
    		
    		for(int i = 0; i < 5; i++) {
    			System.out.println("beep!!");
    			try { Thread.sleep(500); }
    			catch(Exception e) {}
    		}
    
    	}
    
    }
    ```
    
    ![Untitled](/images/lang_java/multi_thread/작업_스레드_생성과_실행/Untitled%203.png)
    
    - `Runnable beepTask = new BeepTask();` 로 BeepTask 객체 생성
        - 이것을 매개값으로 해서 `Thread thread = new Thread(beepTask);` 로 작업 스레드 생성
    - `thread.start();`로 작업 스레드의 `start()` 메소드를 호출하면 작업 스레드에 의해 BeepTask 객체의 `run()` 메소드가 실행되어 비프음 발생
        - 동시에 메인 스레드는 for문을 실행시켜 0.5초 간격으로 “beep!!”을 프린팅
- ex) 위의 다른 방법
    
    ```java
    // Runnable 익명 객체 이용
    Thread thread = new Thread(new Runnable(){
    	@Override
    	public void run() {
    		// 스레드 실행 내용
    		Toolkit toolkit = Toolkit.getDefaultToolkit();
    		for(int i = 0; i < 5; i++){
    			toolkit.beep();
    			try { Thread.sleep(500); } catch(Exception e) {}
    		}
    	}
    });
    ```
    
    ```java
    // 람다식 이용
    Thread thread = new Thread(() -> {
    	// 스레드 싫행 내용
    	Toolkit toolkit = Toolkit.getDefaultToolkit();
    	for(int i = 0; i < 5; i++){
    		toolkit.beep();
    		try { Thread.sleep(500); } catch(Exception e) {}
    	}
    });
    ```
    

---

# 2. Thread 하위 클래스로부터 작성

- 작업 스레드가 실행할 작업을 Runnable로 만들지 않고, Thread의 하위 클래스로 작업 스레드를 정의하면서 작업 내용을 포함시킬 수도 있다.
- 작업 스레드 클래스를 정의하는 방법
    - Thread 클래스를 상속한 후 run 메소드를 overriding해서 스레드가 실행할 코드를 작성하면 된다.
- 작업 스레드 클래스로부터 작업 스레드 객체를 생성하는 방법
    - 일반적인 객체를 생성하는 방법과 동일
        
        ```java
        public class WorkerThread extends Thread {
        	// run() 메소드 재정의
        	@Override
        	public void run() {
        		// 스레드가 실행할 코드
        	}
        }
        Thread thread = new WorkerThread();
        ```
        
    - Thread 익명 객체로 작업 스레드 객체를 생성할 수 있다.
        
        ```java
        Thread thread = new Thread() {} // 익명 자식 객체
        	public void run() {
        		// 스레드가 실행할 코드
        	}
        ;
        ```
        
    - 이렇게 생성된 작업 스레드 객체에서 `start()` 메소드를 호출하면 작업 스레드는 자신의 `run()` 메소드를 실행
        
        ```java
        thread.start();
        ```
        
        ![Untitled](/images/lang_java/multi_thread/작업_스레드_생성과_실행/Untitled%204.png)
        
- ex) 비프음을 들려주는 스레드
    - Runnable을 생성하지 않고 Thread 하위 클래스로 작업 스레드 정의
    - BeepThread.java
    
    ```java
    import java.awt.Toolkit;
    
    public class BeepThread extends Thread{
    	@Override
    	public void run() {
    		// 스레드 실행 내용
    		Toolkit toolkit = Toolkit.getDefaultToolkit();
    		for(int i = 0; i < 5; i++) {
    			toolkit.beep();
    			try { Thread.sleep(500); }
    			catch(Exception e) {}
    		}
    	}
    }
    ```
    
- ex) 메인 스레드와 작업 스레드가 동시에 실행
    - BeepThread 클래스를 이용해서 작업 스레드 객체를 생성하고 실행
    - BeepPrintEx3.java
    
    ```java
    public class BeepPrintEx3 {
    
    	public static void main(String[] args) { // 메인 스레드
    		Thread thread = new BeepThread();
    		thread.start(); // BeapThread
    		
    		for(int i = 0; i < 5; i++) {
    			System.out.println("beep!!");
    			try { Thread.sleep(500); }
    			catch(Exception e) {}
    		}
    
    	}
    
    }
    ```
    
    ![Untitled](/images/lang_java/multi_thread/작업_스레드_생성과_실행/Untitled%205.png)
    
    - `Thread thread = new BeepThread();`에서 BeepThread 객체를 생성
    - `thread.start();`에서 `start()` 메소드를 호출하여 BeepThread가 `run()` 메소드를 실행
    - 동시에 메인 스레드는 for문을 실행시켜 0.5초 간격으로 “beep!!”을 프린팅
- ex) 다른 방법
    
    ```java
    Thread thread = new Thread() {
    	@OVerride
    	pulbic void run() {
    		// 스레드 실행 내용
    		Toolkit toolkit = Toolkit.getDefaultToolkit();
    		for(int i = 0; i < 5; i++){
    			toolkit.beep();
    			try { Thread.sleep(500); } catch(Exception e) {}
    		}
    	}
    };
    ```
    

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판