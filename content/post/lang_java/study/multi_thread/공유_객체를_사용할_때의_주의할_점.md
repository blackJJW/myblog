---
title: "[Java] 공유 객체를 사용할 때의 주의할 점"
description: ""
date: "2022-10-05T21:40:30+09:00"
thumbnail: ""
categories:
  - "Java"
tags:
  - "Java"


---
<!--more-->

- 싱글 스레드 프로그램에서는 한 개의 스레드가 객체를 독차지해서 사용하면 된다.
- 멀티 스레드 프로그램에서는 스레드들이 객체를 공유해서 작업해야 하는 경우가 있다.
    - 이 경우 스레드 A를 사용하던 객체가 스레드 B에 의해 상태가 변경될수 있기 때문에 스레드 A가 의도했던 것과는 다른 결과가 나올 수 있다.
    
    ![Untitled](/images/lang_java/multi_thread/공유_객체를_사용할_때의_주의할_점/Untitled.png)
    
    - User1 스레드가 Calculator 객체의 memory 필드에 100을 먼저 저장하고 2초간 일시 정지 상태가 된다.
        - 그동안에 User2 스레드가 memory 필드값을 50으로 변경
        - 2초가 지나 User1 스레드가 다시 실행 상태가 되어 memory 필드의 값을 출력하면 User2가 저장한 50이 나온다.
- ex) 메인 스레드가 실행하는 코드
    - MainThreadEx.java
    
    ```java
    public class MainThreadEx {
    
    	public static void main(String[] args) {
    		Calculator calculator = new Calculator();
    		
    		// User1 스레드 생성
    		User1 user1 = new User1();
    		// 공유 객체 설정
    		user1.setCalculator(calculator);
    		// User1 스레드 시작
    		user1.start();
    		
    		// User2 스레드 생성
    		User2 user2 = new User2();
    		// 공유 객체 설정
    		user2.setCalculator(calculator);
    		// User1 스레드 시작
    		user2.start();
    
    	}
    
    }
    ```
    
    ![Untitled](/images/lang_java/multi_thread/공유_객체를_사용할_때의_주의할_점/Untitled%201.png)
    
- ex) 공유 객체
    - Calculator.java
    
    ```java
    public class Calculator {
    	private int memory;
    	
    	public int getMemory() {
    		return memory;
    	}
    	
    	// 계산기 메모리에 값을 저장하는 메소드
    	public void setMemory(int memory) {
    		this.memory = memory; // 매개값을 memory 필드에 저장
    		// 스레드를 2초간 일시 정지 시킴
    		try {
    			Thread.sleep(2000);
    		} catch(InterruptedException e) {}
    		System.out.println(Thread.currentThread().getName() + " : " + this.memory);
    		                   // 스레드의 이름                              메모리의 값
    	}
    
    }
    ```
    
- ex) User1 스레드
    - User1.java
    
    ```java
    public class User1 extends Thread{
    	private Calculator calculator;
    	
    	public void setCalculator(Calculator calculator) {
    		// 스레드 이름을 User1로 설정
    		this.setName("User1");
    		// 공유 객체인 Caculator를 필드에 저장
    		this.calculator = calculator;
    	}
    	
    	public void run() {
    		// 공유 객체인 Calculator의 메모리에 100을 저장
    		calculator.setMemory(100);
    	}
    
    }
    ```
    
- ex) User2 스레드
    - User2.java
    
    ```java
    public class User2 extends Thread{
    	private Calculator calculator;
    	
    	public void setCalculator(Calculator calculator) {
    		// 스레드 이름을 User2로 설정
    		this.setName("User2");
    		// 공유 객체인 Caculator를 필드에 저장
    		this.calculator = calculator;
    	}
    	
    	public void run() {
    		// 공유 객체인 Calculator의 메모리에 50을 저장
    		calculator.setMemory(50);
    	}
    
    }
    ```
    

---

## References

- 이것이 자바다 신용권의 Java 프로그래밍 정복 - 신용권 지음, 한빛미디어 출판